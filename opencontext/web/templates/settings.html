{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">System Settings</h1>
    </div>

    <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="model-tab" data-bs-toggle="tab" data-bs-target="#model" type="button" role="tab">
                <i class="bi bi-cpu"></i> Model Config
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="capture-tab" data-bs-toggle="tab" data-bs-target="#capture" type="button" role="tab">
                <i class="bi bi-inbox"></i> Capture Config
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="processing-tab" data-bs-toggle="tab" data-bs-target="#processing" type="button" role="tab">
                <i class="bi bi-gear"></i> Processing Config
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="scheduler-tab" data-bs-toggle="tab" data-bs-target="#scheduler" type="button" role="tab">
                <i class="bi bi-clock"></i> Scheduler &amp; Cache
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="prompts-tab" data-bs-toggle="tab" data-bs-target="#prompts" type="button" role="tab">
                <i class="bi bi-code-square"></i> Prompts
            </button>
        </li>
    </ul>

    <div class="tab-content" id="settingsTabContent">

        <!-- ==================== Tab 1: Model Config ==================== -->
        <div class="tab-pane fade show active" id="model" role="tabpanel">
            <div class="row mt-4">
                <div class="col-md-10">
                    <!-- LLM Text Model -->
                    <div class="card mb-4">
                        <div class="card-header"><strong>LLM Text Model</strong></div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="llm_provider" class="form-label">Provider</label>
                                    <select class="form-select" id="llm_provider">
                                        <option value="openai">OpenAI</option>
                                        <option value="doubao">Doubao</option>
                                        <option value="dashscope">DashScope</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="llm_model" class="form-label">Model</label>
                                    <input type="text" class="form-control" id="llm_model" placeholder="e.g. gpt-4o">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="llm_max_concurrent" class="form-label">Max Concurrent</label>
                                    <input type="number" class="form-control" id="llm_max_concurrent" min="1">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="llm_base_url" class="form-label">Base URL</label>
                                    <input type="text" class="form-control" id="llm_base_url" placeholder="https://api.openai.com/v1">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="llm_api_key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="llm_api_key">
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-info" onclick="validateModelSection('llm')">
                                <i class="bi bi-check-circle"></i> Test Connection
                            </button>
                        </div>
                    </div>

                    <!-- VLM Model -->
                    <div class="card mb-4">
                        <div class="card-header"><strong>VLM (Vision Language Model)</strong></div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="vlm_provider" class="form-label">Provider</label>
                                    <select class="form-select" id="vlm_provider">
                                        <option value="openai">OpenAI</option>
                                        <option value="doubao">Doubao</option>
                                        <option value="dashscope">DashScope</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="vlm_model" class="form-label">Model</label>
                                    <input type="text" class="form-control" id="vlm_model" placeholder="e.g. gpt-4o">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="vlm_max_concurrent" class="form-label">Max Concurrent</label>
                                    <input type="number" class="form-control" id="vlm_max_concurrent" min="1">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="vlm_base_url" class="form-label">Base URL</label>
                                    <input type="text" class="form-control" id="vlm_base_url" placeholder="https://api.openai.com/v1">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="vlm_api_key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="vlm_api_key">
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-info" onclick="validateModelSection('vlm_model')">
                                <i class="bi bi-check-circle"></i> Test Connection
                            </button>
                        </div>
                    </div>

                    <!-- Embedding Model -->
                    <div class="card mb-4">
                        <div class="card-header"><strong>Embedding Model</strong></div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="emb_provider" class="form-label">Provider</label>
                                    <select class="form-select" id="emb_provider">
                                        <option value="openai">OpenAI</option>
                                        <option value="doubao">Doubao</option>
                                        <option value="dashscope">DashScope</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="emb_model" class="form-label">Model</label>
                                    <input type="text" class="form-control" id="emb_model" placeholder="e.g. text-embedding-3-large">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="emb_max_concurrent" class="form-label">Max Concurrent</label>
                                    <input type="number" class="form-control" id="emb_max_concurrent" min="1">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="emb_output_dim" class="form-label">Output Dim</label>
                                    <input type="number" class="form-control" id="emb_output_dim" min="1">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="emb_base_url" class="form-label">Base URL</label>
                                    <input type="text" class="form-control" id="emb_base_url" placeholder="https://api.openai.com/v1">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="emb_api_key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="emb_api_key">
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-info" onclick="validateModelSection('embedding_model')">
                                <i class="bi bi-check-circle"></i> Test Connection
                            </button>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" onclick="saveAllModels()">
                            <i class="bi bi-save"></i> Save All
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="loadModelSettings()">
                            <i class="bi bi-arrow-clockwise"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== Tab 2: Capture Config ==================== -->
        <div class="tab-pane fade" id="capture" role="tabpanel">
            <div class="row mt-4">
                <div class="col-md-10">
                    <form id="captureForm">
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="capture_enabled">
                            <label class="form-check-label fw-bold" for="capture_enabled">Enable Capture</label>
                        </div>

                        <!-- Text Chat Capture -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Text Chat Capture</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="text_chat_enabled">
                                        <label class="form-check-label" for="text_chat_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="text_chat_buffer_size" class="form-label">Buffer Size</label>
                                        <input type="number" class="form-control" id="text_chat_buffer_size" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Folder Monitor -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Folder Monitor</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="folder_monitor_enabled">
                                        <label class="form-check-label" for="folder_monitor_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="folder_monitor_interval" class="form-label">Monitor Interval (s)</label>
                                        <input type="number" class="form-control" id="folder_monitor_interval" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="folder_monitor_max_file_size" class="form-label">Max File Size (MB)</label>
                                        <input type="number" class="form-control" id="folder_monitor_max_file_size" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="form-check form-switch mt-4">
                                            <input class="form-check-input" type="checkbox" id="folder_monitor_recursive">
                                            <label class="form-check-label" for="folder_monitor_recursive">Recursive</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="folder_monitor_initial_scan">
                                            <label class="form-check-label" for="folder_monitor_initial_scan">Initial Scan</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="folder_monitor_paths" class="form-label">Watch Folder Paths (one per line)</label>
                                    <textarea class="form-control" id="folder_monitor_paths" rows="3" placeholder="/path/to/folder1&#10;/path/to/folder2"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Vault Document Monitor -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Vault Document Monitor</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="vault_enabled">
                                        <label class="form-check-label" for="vault_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="vault_interval" class="form-label">Monitor Interval (s)</label>
                                        <input type="number" class="form-control" id="vault_interval" min="1">
                                    </div>
                                    <div class="col-md-4 mb-3 form-check form-switch mt-4">
                                        <input class="form-check-input" type="checkbox" id="vault_initial_scan">
                                        <label class="form-check-label" for="vault_initial_scan">Initial Scan</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> Save</button>
                            <button type="button" class="btn btn-secondary" onclick="loadCaptureSettings()"><i class="bi bi-arrow-clockwise"></i> Reset</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ==================== Tab 3: Processing Config ==================== -->
        <div class="tab-pane fade" id="processing" role="tabpanel">
            <div class="row mt-4">
                <div class="col-md-10">
                    <form id="processingForm">
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="processing_enabled">
                            <label class="form-check-label fw-bold" for="processing_enabled">Enable Processing</label>
                        </div>

                        <!-- Text Chat Processor -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Text Chat Processor</strong></div>
                            <div class="card-body">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="text_chat_proc_enabled">
                                    <label class="form-check-label" for="text_chat_proc_enabled">Enabled</label>
                                </div>
                            </div>
                        </div>

                        <!-- Document Processor -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Document Processor</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="doc_proc_enabled">
                                        <label class="form-check-label" for="doc_proc_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="doc_proc_batch_size" class="form-label">Batch Size</label>
                                        <input type="number" class="form-control" id="doc_proc_batch_size" min="1">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="doc_proc_batch_timeout" class="form-label">Batch Timeout (s)</label>
                                        <input type="number" class="form-control" id="doc_proc_batch_timeout" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Screenshot Processor -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Screenshot Processor</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="screenshot_proc_enabled">
                                        <label class="form-check-label" for="screenshot_proc_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="screenshot_hash_threshold" class="form-label">Hash Threshold</label>
                                        <input type="number" class="form-control" id="screenshot_hash_threshold" min="0" max="64">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="screenshot_batch_size" class="form-label">Batch Size</label>
                                        <input type="number" class="form-control" id="screenshot_batch_size" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="screenshot_batch_timeout" class="form-label">Batch Timeout (s)</label>
                                        <input type="number" class="form-control" id="screenshot_batch_timeout" min="1">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="screenshot_max_raw_props" class="form-label">Max Raw Properties</label>
                                        <input type="number" class="form-control" id="screenshot_max_raw_props" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="screenshot_max_image_size" class="form-label">Max Image Size (px)</label>
                                        <input type="number" class="form-control" id="screenshot_max_image_size" min="100">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="screenshot_resize_quality" class="form-label">Resize Quality</label>
                                        <input type="number" class="form-control" id="screenshot_resize_quality" min="1" max="100">
                                    </div>
                                    <div class="col-md-3 mb-3 form-check form-switch mt-4">
                                        <input class="form-check-input" type="checkbox" id="screenshot_enabled_delete">
                                        <label class="form-check-label" for="screenshot_enabled_delete">Delete After Process</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Context Merger (Knowledge) -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Knowledge Merger</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="merger_enabled">
                                        <label class="form-check-label" for="merger_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="merger_threshold" class="form-label">Similarity Threshold</label>
                                        <input type="number" class="form-control" id="merger_threshold" min="0" max="1" step="0.01">
                                    </div>
                                    <div class="col-md-4 mb-3 form-check form-switch mt-4">
                                        <input class="form-check-input" type="checkbox" id="merger_intelligent">
                                        <label class="form-check-label" for="merger_intelligent">Intelligent Merging</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="merger_memory_mgmt">
                                        <label class="form-check-label" for="merger_memory_mgmt">Memory Management</label>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="merger_retention_days" class="form-label">Retention Days</label>
                                        <input type="number" class="form-control" id="merger_retention_days" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="merger_sim_threshold" class="form-label">Knowledge Sim Threshold</label>
                                        <input type="number" class="form-control" id="merger_sim_threshold" min="0" max="1" step="0.01">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="merger_max_merge_count" class="form-label">Max Merge Count</label>
                                        <input type="number" class="form-control" id="merger_max_merge_count" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Processing Parameters -->
                        <div class="card mb-4">
                            <div class="card-header"><strong>Document Processing Parameters</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="docproc_batch_size" class="form-label">VLM Batch Size</label>
                                        <input type="number" class="form-control" id="docproc_batch_size" min="1">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="docproc_dpi" class="form-label">PDF DPI</label>
                                        <input type="number" class="form-control" id="docproc_dpi" min="72" max="600">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="docproc_text_threshold" class="form-label">Text Threshold/Page</label>
                                        <input type="number" class="form-control" id="docproc_text_threshold" min="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> Save</button>
                            <button type="button" class="btn btn-secondary" onclick="loadProcessingSettings()"><i class="bi bi-arrow-clockwise"></i> Reset</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ==================== Tab 4: Scheduler & Cache ==================== -->
        <div class="tab-pane fade" id="scheduler" role="tabpanel">
            <div class="row mt-4">
                <div class="col-md-10">
                    <form id="schedulerCacheForm">
                        <!-- Scheduler -->
                        <h4>Scheduler</h4>
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="scheduler_enabled">
                            <label class="form-check-label fw-bold" for="scheduler_enabled">Enable Scheduler</label>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-4 mb-3">
                                <label for="executor_check_interval" class="form-label">Check Interval (s)</label>
                                <input type="number" class="form-control" id="executor_check_interval" min="1">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="executor_max_concurrent" class="form-label">Max Concurrent</label>
                                <input type="number" class="form-control" id="executor_max_concurrent" min="1">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="executor_lock_timeout" class="form-label">Lock Timeout (s)</label>
                                <input type="number" class="form-control" id="executor_lock_timeout" min="1">
                            </div>
                        </div>

                        <!-- memory_compression task -->
                        <div class="card mb-3">
                            <div class="card-header"><strong>Memory Compression</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="task_mc_enabled">
                                        <label class="form-check-label" for="task_mc_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="task_mc_trigger" class="form-label">Trigger Mode</label>
                                        <select class="form-select" id="task_mc_trigger">
                                            <option value="user_activity">user_activity</option>
                                            <option value="periodic">periodic</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="task_mc_interval" class="form-label">Interval (s)</label>
                                        <input type="number" class="form-control" id="task_mc_interval" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="task_mc_ttl" class="form-label">Task TTL (s)</label>
                                        <input type="number" class="form-control" id="task_mc_ttl" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- data_cleanup task -->
                        <div class="card mb-3">
                            <div class="card-header"><strong>Data Cleanup</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-2 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="task_dc_enabled">
                                        <label class="form-check-label" for="task_dc_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="task_dc_trigger" class="form-label">Trigger</label>
                                        <select class="form-select" id="task_dc_trigger">
                                            <option value="periodic">periodic</option>
                                            <option value="user_activity">user_activity</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="task_dc_interval" class="form-label">Interval (s)</label>
                                        <input type="number" class="form-control" id="task_dc_interval" min="1">
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="task_dc_timeout" class="form-label">Timeout (s)</label>
                                        <input type="number" class="form-control" id="task_dc_timeout" min="1">
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="task_dc_retention" class="form-label">Retention Days</label>
                                        <input type="number" class="form-control" id="task_dc_retention" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- hierarchy_summary task -->
                        <div class="card mb-3">
                            <div class="card-header"><strong>Hierarchy Summary</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3 form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="task_hs_enabled">
                                        <label class="form-check-label" for="task_hs_enabled">Enabled</label>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="task_hs_trigger" class="form-label">Trigger Mode</label>
                                        <select class="form-select" id="task_hs_trigger">
                                            <option value="user_activity">user_activity</option>
                                            <option value="periodic">periodic</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="task_hs_interval" class="form-label">Interval (s)</label>
                                        <input type="number" class="form-control" id="task_hs_interval" min="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="task_hs_timeout" class="form-label">Timeout (s)</label>
                                        <input type="number" class="form-control" id="task_hs_timeout" min="1">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="task_hs_ttl" class="form-label">Task TTL (s)</label>
                                        <input type="number" class="form-control" id="task_hs_ttl" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Memory Cache -->
                        <h4>Memory Cache</h4>
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <label for="cache_snapshot_ttl" class="form-label">Snapshot TTL (s)</label>
                                <input type="number" class="form-control" id="cache_snapshot_ttl" min="1">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cache_recent_days" class="form-label">Recent Days</label>
                                <input type="number" class="form-control" id="cache_recent_days" min="1">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cache_max_recently" class="form-label">Max Recently Accessed</label>
                                <input type="number" class="form-control" id="cache_max_recently" min="1">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cache_max_today_events" class="form-label">Max Today Events</label>
                                <input type="number" class="form-control" id="cache_max_today_events" min="1">
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <label for="cache_max_documents" class="form-label">Max Recent Documents</label>
                                <input type="number" class="form-control" id="cache_max_documents" min="1">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cache_max_knowledge" class="form-label">Max Recent Knowledge</label>
                                <input type="number" class="form-control" id="cache_max_knowledge" min="1">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cache_accessed_ttl" class="form-label">Accessed TTL (s)</label>
                                <input type="number" class="form-control" id="cache_accessed_ttl" min="1">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cache_max_entities" class="form-label">Max Entities</label>
                                <input type="number" class="form-control" id="cache_max_entities" min="1">
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> Save</button>
                            <button type="button" class="btn btn-secondary" onclick="loadSchedulerCacheSettings()"><i class="bi bi-arrow-clockwise"></i> Reset</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ==================== Tab 5: Prompts ==================== -->
        <div class="tab-pane fade" id="prompts" role="tabpanel">
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center gap-3">
                            <h4 class="mb-0">Prompts</h4>
                            <select class="form-select form-select-sm" style="width: 200px;" id="promptLanguage" onchange="changePromptLanguage()">
                                <option value="zh">Chinese (zh)</option>
                                <option value="en">English (en)</option>
                            </select>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="saveAllPrompts()">
                                <i class="bi bi-save"></i> Save All
                            </button>
                            <button class="btn btn-secondary" onclick="exportPrompts()">
                                <i class="bi bi-download"></i> Export
                            </button>
                            <label class="btn btn-secondary" for="importFile">
                                <i class="bi bi-upload"></i> Import
                            </label>
                            <input type="file" id="importFile" accept=".yaml,.yml" style="display:none" onchange="importPrompts(event)">
                            <button class="btn btn-warning" onclick="resetAllSettings()">
                                <i class="bi bi-arrow-counterclockwise"></i> Reset All
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Left: Prompt Tree -->
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Prompt Tree</div>
                                <div class="card-body p-0">
                                    <div id="promptTree" class="list-group list-group-flush" style="max-height: 600px; overflow-y: auto;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Right: Editor -->
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <span id="currentPromptKey" class="text-muted">Select a prompt from the tree</span>
                                </div>
                                <div class="card-body">
                                    <textarea class="form-control font-monospace" id="promptEditor" rows="20" placeholder="Select a prompt key to edit..."></textarea>
                                    <button class="btn btn-primary mt-3" onclick="saveCurrentPrompt()">
                                        <i class="bi bi-save"></i> Save Current
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="settingsToast" class="toast" role="alert">
        <div class="toast-header">
            <strong class="me-auto">Settings</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            OK
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/settings.js"></script>
{% endblock %}
